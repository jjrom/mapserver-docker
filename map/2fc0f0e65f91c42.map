
        MAP
            EXTENT -180.0 -85.0 180.0 85.0
            IMAGECOLOR 255 255 255
            SIZE 256 256
            STATUS ON
            UNITS DD
            DEBUG 0
            OUTPUTFORMAT
                NAME "AGGPNG"
                DRIVER "AGG/PNG"
                EXTENSION "png"
                MIMETYPE "image/png"
                IMAGEMODE RGBA
                TRANSPARENT ON
                FORMATOPTION "TRANSPARENT=ON"
            END
            WEB
              IMAGEPATH "/tmp/"
              IMAGEURL "/"
              METADATA
                "ows_enable_request"   "*"
                "wms_title"          "resto heatmap"
                "wms_onlineresource" "http://mapserver/wms/2fc0f0e65f91c42&"
                "wms_srs"            "EPSG:4326 EPSG:3857"
                "wms_feature_info_mime_type"    "text/html"
              END
            END
            PROJECTION
              "init=epsg:3857"
            END
            SYMBOL
                TYPE ellipse
                POINTS 1 1 END
                NAME "circle"
            END
            LAYER
                NAME "heatmap"
                TYPE raster
                CONNECTIONTYPE kerneldensity
                CONNECTION "centroids"
                STATUS ON
                PROCESSING "RANGE_COLORSPACE=HSL"
                PROCESSING "KERNELDENSITY_RADIUS=20"
                PROCESSING "KERNELDENSITY_COMPUTE_BORDERS=ON"
                #PROCESSING "KERNELDENSITY_NORMALIZATION=16"
                PROCESSING "KERNELDENSITY_NORMALIZATION=%normalization%"
                #PROCESSING "KERNELDENSITY_RADIUS=%radius%"
                SCALETOKEN
                    NAME "%normalization%"
                    VALUES
                        "0" "256"
                        "31250"   "128"
                        "625000"  "64"
                        "1250000"  "32"
                        "25000000" "16"
                    END # VALUES
                END # SCALETOKEN
                OFFSITE 0 0 0
                CLASS
                    STYLE
                        COLORRANGE  "#0080ff00"  "#0080ffff"
                        DATARANGE 0 32
                    END # STYLE
                    STYLE
                        COLORRANGE  "#0080ffff"  "#ff0000ff"
                        DATARANGE 32 255
                    END # STYLE
                END # CLASS
            END # LAYER
            LAYER
                NAME "centroids"
                STATUS ON
                VALIDATION
                    "FROM"          "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
                    "TO"            "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
                    "COLLECTION"    "^[a-zA-Z0-9]+$"
                END
                TYPE POINT
                DATA "centroid FROM (SELECT resto.feature.centroid, resto.feature.id FROM resto.feature  WHERE resto.feature.visibility IN (100)) AS foo using unique id using srid = 4326"
                CONNECTION "user=resto password=resto dbname=resto host=restodb port=5432"
                PROCESSING "CLOSE_CONNECTION=DEFER"
                CONNECTIONTYPE POSTGIS
                PROJECTION
                    "+init=epsg:4326"
                END
                CLASS
                    STYLE
                        SYMBOL "circle"
                        SIZE 4
                        COLOR 128 128 255
                        OUTLINECOLOR 90 90 255
                    END
                END
            END
            LAYER
                NAME "footprints"
                STATUS ON
                #MAXSCALEDENOM 10000000
                VALIDATION
                    "FROM"          "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
                    "TO"            "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
                    "COLLECTION"    "^[a-zA-Z0-9]+$"
                END
                TYPE POLYGON
                DATA "_geometry FROM (SELECT resto.feature._geometry, resto.feature.id FROM resto.feature  WHERE resto.feature.visibility IN (100)) AS foo using unique id using srid = 4326"
                CONNECTION "user=resto password=resto dbname=resto host=restodb port=5432"
                PROCESSING "CLOSE_CONNECTION=DEFER"
                CONNECTIONTYPE POSTGIS
                PROJECTION
                    "+init=epsg:4326"
                END
                CLASS
                    STYLE
                        OUTLINECOLOR 90 90 255
                        COLOR 128 128 255
                        OPACITY 10
                    END
                END
            END
        END